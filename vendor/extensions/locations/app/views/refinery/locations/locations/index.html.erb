<% content_for :body_content_left do %>
  <article id="locations">
    <div id="locations_index_map"></div>

    <ul id="locations">
      <% @locations.each do |location| %>
        <li>
          <%= link_to location.name, refinery.locations_location_path(location) %>
        </li>
      <% end %>
    </ul>
  </article>
<% end %>

<% content_for :body_content_right do %>
  <% location = @locations.first %>
  <% if location %>
    <div class="map_sidebar">
      <div class="arrow"></div>
      <div class="location_preview" id="location_preview">
        <h2 class="location_name"></h2>
        <div class="location_content">
          <div class="description_preview"></div>
          <% image = location.images.first %>
          <%= image_tag(image.thumbnail("253x160#c").url, :class => 'location_image') if image %>
          <%= link_to "more details", "/locations/#{location.to_param}" %>
        </div>
      </div>
    </div>
  <% end %>
<% end %>


<% content_for :javascripts do %>
  <%= javascript_include_tag('http://maps.google.com/maps/api/js?sensor=true') %>
  <%= javascript_include_tag('refinery/locations/vendor/gmaps.js') %>
  <%= javascript_include_tag('refinery/locations/locations_map') %>
  <script type="text/javascript">
    $(document).ready(function(){
      var locations_map = new Application.LocationsMap('#locations_index_map', <%= Refinery::Locations.config.map_center %>);
      locations_map.addLocations(<%= @locations.to_json(:methods => [:description_preview]).html_safe %>);
    });
  </script><% end %>

<%= render '/refinery/content_page' %>


